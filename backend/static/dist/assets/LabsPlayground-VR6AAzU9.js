import{r as a,j as e}from"./main-DEHa6zRv.js";const pe={provider:"",chatModel:"",embedModel:"",embedDim:0,hasApiKey:!1,canUseOpenAI:!1},Ue="You are Quell AI's design-time assistant. Provide clear, actionable responses.";function x(r){return`${r}-${Math.random().toString(36).slice(2,10)}`}async function h(r,S){const p=await fetch(r,S);if(!p.ok){const i=await p.json().catch(()=>({})),c=typeof i?.error=="string"?i.error:`Request failed (${p.status})`;throw new Error(c)}return p.json()}function qe(){const[r,S]=a.useState(pe),[p,i]=a.useState(""),[c,$]=a.useState(""),[q,v]=a.useState(!1),[A,ue]=a.useState(Ue),[k,N]=a.useState([{id:x("mcp"),label:"Objective",content:""},{id:x("mcp"),label:"Constraints",content:""}]),[R,K]=a.useState(null),[_,F]=a.useState(!1),[G,J]=a.useState(""),[u,O]=a.useState([]),[m,D]=a.useState({title:"",content:""}),[C,he]=a.useState(""),[Q,W]=a.useState(!1),[z,d]=a.useState(""),[B,Y]=a.useState(null),[E,M]=a.useState([{role:"assistant",content:"Welcome! Ask a question to see the assistant in action."}]),[P,H]=a.useState(""),[V,X]=a.useState(!1),[Z,ee]=a.useState(""),[g,I]=a.useState([""]),[y,te]=a.useState([]),[w,me]=a.useState(""),[se,ae]=a.useState(!1),[ne,b]=a.useState(""),[L,oe]=a.useState(null),[T,xe]=a.useState(""),[le,re]=a.useState(!1),[ie,U]=a.useState(""),[ce,de]=a.useState(null),ge=u.length>0,ye=r.canUseOpenAI&&r.hasApiKey,f=a.useCallback(async()=>{v(!0),i("");try{const t=await h("/api/labs/status");S(t),i(t.canUseOpenAI?"OpenAI access is ready.":"OpenAI access is currently offline. Requests will fall back to local heuristics.")}catch(t){S(pe),i(t instanceof Error?t.message:"Unable to load status.")}finally{v(!1)}},[]);a.useEffect(()=>{f();try{const t=localStorage.getItem("qa_openai_key");t&&$(t)}catch{}},[f]);const be=a.useCallback(()=>{try{c.trim()?localStorage.setItem("qa_openai_key",c.trim()):localStorage.removeItem("qa_openai_key"),i("Key stored locally. Send it to the server when ready.")}catch(t){i(t instanceof Error?t.message:"Unable to access local storage.")}},[c]),fe=a.useCallback(async t=>{t.preventDefault(),v(!0),i("");try{await h("/api/labs/api-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:c})}),i("Server connection updated."),await f()}catch(s){i(s instanceof Error?s.message:"Failed to update server key.")}finally{v(!1)}},[c,f]),je=a.useCallback((t,s)=>{N(n=>n.map(o=>o.id===t?{...o,label:s}:o))},[]),Se=a.useCallback((t,s)=>{N(n=>n.map(o=>o.id===t?{...o,content:s}:o))},[]),ve=a.useCallback(()=>{N(t=>[...t,{id:x("mcp"),label:"New Component",content:""}])},[]),ke=a.useCallback(t=>{N(s=>s.length<=1?s:s.filter(n=>n.id!==t))},[]),Ne=a.useCallback(async t=>{t.preventDefault(),J(""),K(null),F(!0);try{const s={instructions:A,components:k.map(({label:o,content:l})=>({label:o,content:l}))},n=await h("/api/labs/mcp/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});K({response:n.response,combinedPrompt:n.combinedPrompt})}catch(s){J(s instanceof Error?s.message:"Unable to run multi-component prompt.")}finally{F(!1)}},[k,A]),Ce=a.useCallback(()=>{if(!m.content.trim()){d("Add content before saving the document.");return}O(t=>[...t,{id:x("doc"),title:m.title.trim()||`Document ${t.length+1}`,content:m.content.trim()}]),D({title:"",content:""}),d("")},[m]),we=a.useCallback(t=>{O(s=>s.filter(n=>n.id!==t))},[]),Te=a.useCallback(t=>{const s=t.target.files?.[0];s&&s.text().then(n=>{O(o=>[...o,{id:x("doc"),title:s.name||`Document ${o.length+1}`,content:n}]),d("")}).catch(()=>d("Unable to read the selected file."))},[]),Ae=a.useCallback(async t=>{if(t.preventDefault(),d(""),Y(null),!u.length){d("Add at least one document before querying.");return}if(!C.trim()){d("Enter a query to continue.");return}W(!0);try{const s={query:C,documents:u.map(({title:o,content:l})=>({title:o,content:l}))},n=await h("/api/labs/rag/workbench",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});Y(n)}catch(s){d(s instanceof Error?s.message:"Unable to run RAG query.")}finally{W(!1)}},[u,C]),Re=a.useCallback(async t=>{t.preventDefault(),ee("");const s=P.trim();if(!s)return;const n={role:"user",content:s},o=[...E,n];M(o),H(""),X(!0);try{const l=await h("/api/labs/chat/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:o})});M(j=>[...j,{role:"assistant",content:l.reply}])}catch(l){ee(l instanceof Error?l.message:"Unable to contact assistant."),M(j=>[...j,{role:"assistant",content:"The assistant is unavailable right now."}])}finally{X(!1)}},[P,E]),Oe=a.useCallback((t,s)=>{I(n=>n.map((o,l)=>l===t?s:o))},[]),De=a.useCallback(()=>{I(t=>[...t,""])},[]),Be=a.useCallback(t=>{I(s=>s.length<=1?s:s.filter((n,o)=>o!==t))},[]),Ee=a.useCallback(t=>{const s=t.target.files?.[0];if(!s)return;const n=new FileReader;n.onload=()=>{const o=typeof n.result=="string"?n.result:"";te(l=>[...l,{id:x("file"),name:s.name||`Upload-${l.length+1}`,content:o,encoding:o.startsWith("data:")?"base64":"text"}])},n.onerror=()=>b("Unable to read the uploaded file."),n.readAsDataURL(s)},[]),Me=a.useCallback(t=>{te(s=>s.filter(n=>n.id!==t))},[]),Pe=a.useCallback(async t=>{if(t.preventDefault(),b(""),oe(null),!w.trim()){b("Ask the assistant a question.");return}if(!g.some(s=>s.trim())&&y.length===0){b("Add at least one note or file.");return}ae(!0);try{const s={question:w,notes:g.filter(o=>o.trim()),files:y.map(({name:o,content:l,encoding:j})=>({name:o,content:l,encoding:j}))},n=await h("/api/labs/notebook/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});oe(n)}catch(s){b(s instanceof Error?s.message:"Notebook assistant is unavailable.")}finally{ae(!1)}},[y,g,w]),Ie=a.useCallback(async t=>{if(t.preventDefault(),U(""),de(null),!T.trim()){U("Provide text for the assistant to narrate.");return}re(!0);try{const s=await h("/api/labs/chat/speak",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:T})});de(`data:${s.contentType};base64,${s.audio}`)}catch(s){U(s instanceof Error?s.message:"Unable to synthesize audio.")}finally{re(!1)}},[T]),Le=a.useMemo(()=>r.provider?`Provider: ${r.provider||"fallback"} — chat model: ${r.chatModel}, embed model: ${r.embedModel} (dim ${r.embedDim}).`:"Backend pipeline is running in local fallback mode.",[r]);return e.jsxs("div",{className:"labs-playground",children:[e.jsxs("header",{className:"glass-panel",style:{padding:"32px",marginBottom:"24px"},children:[e.jsx("h1",{style:{marginBottom:"12px"},children:"AI Blueprint Playground"}),e.jsx("p",{style:{marginBottom:0},children:"This sandbox focuses on functionality. Use it to wire together OpenAI credentials, experiment with multi-component prompting, retrieval workflows, conversational flows, and notebook-style file reasoning."})]}),e.jsxs("section",{className:"glass-panel",style:{padding:"28px",marginBottom:"28px"},children:[e.jsx("h2",{children:"1. Configure OpenAI Connectivity"}),e.jsx("p",{style:{marginBottom:"12px"},children:"Provide your OpenAI API key to unlock cloud-backed completions. The key is stored locally (for debugging) and can optionally be pushed into the running Flask process."}),e.jsxs("form",{onSubmit:fe,className:"labs-grid",style:{gap:"16px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("span",{children:"OpenAI API Key"}),e.jsx("input",{type:"password",value:c,onChange:t=>$(t.target.value),placeholder:"sk-...",className:"input"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"button-outline",onClick:be,children:"Store in browser"}),e.jsx("button",{type:"submit",className:"button-engage",disabled:q,children:q?"Updating...":"Send to backend"}),e.jsx("button",{type:"button",className:"button-outline",onClick:f,children:"Refresh status"})]})]}),e.jsx("p",{style:{marginTop:"12px",color:"var(--color-grey-600)"},children:Le}),p&&e.jsx("p",{style:{marginTop:"8px",color:ye?"var(--color-green-600)":"var(--color-orange-500)"},children:p})]}),e.jsxs("section",{className:"glass-panel",style:{padding:"28px",marginBottom:"28px"},children:[e.jsx("h2",{children:"2. Multi-Component Prompting (MCP)"}),e.jsx("p",{style:{marginBottom:"12px"},children:"Break complex instructions into labeled components. The playground sends the combined prompt to the backend MCP endpoint so you can verify orchestration logic before wiring production pipelines."}),e.jsxs("form",{onSubmit:Ne,className:"labs-grid",style:{gap:"16px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("span",{children:"System guardrails"}),e.jsx("textarea",{className:"textarea",rows:3,value:A,onChange:t=>ue(t.target.value)})]}),e.jsx("div",{style:{display:"grid",gap:"12px"},children:k.map(t=>e.jsxs("div",{className:"labs-card",style:{padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"12px"},children:[e.jsx("input",{className:"input",value:t.label,onChange:s=>je(t.id,s.target.value),placeholder:"Component label"}),e.jsx("button",{type:"button",className:"button-outline",onClick:()=>ke(t.id),disabled:k.length<=1,children:"Remove"})]}),e.jsx("textarea",{className:"textarea",rows:4,placeholder:"Component content...",value:t.content,onChange:s=>Se(t.id,s.target.value)})]},t.id))}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"button-outline",onClick:ve,children:"Add component"}),e.jsx("button",{type:"submit",className:"button-engage",disabled:_,children:_?"Generating...":"Run MCP"})]})]}),G&&e.jsx("p",{className:"labs-error",style:{marginTop:"12px"},children:G}),R&&e.jsxs("div",{className:"labs-card",style:{marginTop:"16px"},children:[e.jsx("h3",{children:"MCP Output"}),e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:R.response}),e.jsxs("details",{style:{marginTop:"12px"},children:[e.jsx("summary",{children:"View combined prompt"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:R.combinedPrompt})]})]})]}),e.jsxs("section",{className:"glass-panel",style:{padding:"28px",marginBottom:"28px"},children:[e.jsx("h2",{children:"3. Retrieval-Augmented Generation (RAG)"}),e.jsx("p",{style:{marginBottom:"12px"},children:"Load documents, issue a question, and inspect the top matches with the generated answer. This section mirrors the backend helper that combines embeddings with prompt synthesis."}),e.jsxs("form",{onSubmit:Ae,className:"labs-grid",style:{gap:"16px"},children:[e.jsxs("div",{className:"labs-card",style:{padding:"16px"},children:[e.jsx("h3",{children:"Add document"}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"6px",marginBottom:"12px"},children:[e.jsx("span",{children:"Title"}),e.jsx("input",{className:"input",value:m.title,onChange:t=>D(s=>({...s,title:t.target.value}))})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"6px",marginBottom:"12px"},children:[e.jsx("span",{children:"Content"}),e.jsx("textarea",{className:"textarea",rows:4,value:m.content,onChange:t=>D(s=>({...s,content:t.target.value}))})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"button-outline",onClick:Ce,children:"Save document"}),e.jsxs("label",{className:"button-outline",style:{cursor:"pointer"},children:["Upload text file",e.jsx("input",{type:"file",accept:".txt,.md,.json",hidden:!0,onChange:Te})]})]})]}),!!u.length&&e.jsxs("div",{className:"labs-card",style:{padding:"16px"},children:[e.jsxs("h3",{children:["Current knowledge base (",u.length,")"]}),e.jsx("ul",{style:{paddingLeft:"20px",margin:0},children:u.map(t=>e.jsxs("li",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:t.title})," ",e.jsx("button",{type:"button",className:"button-inline",onClick:()=>we(t.id),children:"remove"}),e.jsxs("p",{style:{margin:"4px 0 0",color:"var(--color-grey-600)"},children:[t.content.slice(0,160),t.content.length>160?"...":""]})]},t.id))})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("span",{children:"Ask a question"}),e.jsx("input",{className:"input",value:C,onChange:t=>he(t.target.value),placeholder:"e.g. Summarize the escalation policy."})]}),e.jsx("button",{type:"submit",className:"button-engage",disabled:Q||!ge,children:Q?"Searching...":"Run retrieval"})]}),z&&e.jsx("p",{className:"labs-error",style:{marginTop:"12px"},children:z}),B&&e.jsxs("div",{className:"labs-card",style:{marginTop:"16px"},children:[e.jsx("h3",{children:"Answer"}),e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:B.answer}),e.jsxs("details",{style:{marginTop:"12px"},children:[e.jsx("summary",{children:"Top matches"}),e.jsx("ul",{style:{paddingLeft:"20px",marginTop:"8px"},children:B.matches.map(t=>e.jsxs("li",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:t.title})," — score ",t.score,e.jsx("p",{style:{margin:"4px 0 0",color:"var(--color-grey-600)"},children:t.preview})]},t.title))})]})]})]}),e.jsxs("section",{className:"glass-panel",style:{padding:"28px",marginBottom:"28px"},children:[e.jsx("h2",{children:"4. Conversational Sandbox"}),e.jsx("p",{style:{marginBottom:"12px"},children:"Test the lightweight chatbot endpoint. Add messages to inspect how state is passed to the backend."}),e.jsxs("div",{className:"labs-card",style:{padding:"16px"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",maxHeight:"320px",overflow:"auto"},children:E.map((t,s)=>e.jsxs("div",{className:t.role==="user"?"labs-chat-user":"labs-chat-assistant",style:{alignSelf:t.role==="user"?"flex-end":"flex-start",background:t.role==="user"?"var(--accent-pastel-green)":"var(--color-grey-100)",borderRadius:"16px",padding:"12px 16px"},children:[e.jsx("strong",{style:{display:"block",marginBottom:"6px"},children:t.role==="user"?"You":"Assistant"}),e.jsx("span",{style:{whiteSpace:"pre-wrap"},children:t.content})]},`${t.role}-${s}`))}),e.jsxs("form",{onSubmit:Re,style:{display:"flex",gap:"12px",marginTop:"16px"},children:[e.jsx("input",{className:"input",value:P,onChange:t=>H(t.target.value),placeholder:"Ask something..."}),e.jsx("button",{type:"submit",className:"button-engage",disabled:V,children:V?"Replying...":"Send"})]}),Z&&e.jsx("p",{className:"labs-error",style:{marginTop:"12px"},children:Z})]})]}),e.jsxs("section",{className:"glass-panel",style:{padding:"28px",marginBottom:"28px"},children:[e.jsx("h2",{children:"5. Notebook “LLM Googles”"}),e.jsx("p",{style:{marginBottom:"12px"},children:"Combine inline notes and uploads into a scratchpad, then ask the assistant to reason across them. Useful for validating file ingestion strategies."}),e.jsxs("form",{onSubmit:Pe,className:"labs-grid",style:{gap:"16px"},children:[e.jsxs("div",{className:"labs-card",style:{padding:"16px"},children:[e.jsx("h3",{children:"Notes"}),e.jsx("div",{style:{display:"grid",gap:"12px"},children:g.map((t,s)=>e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("textarea",{className:"textarea",rows:3,value:t,onChange:n=>Oe(s,n.target.value),placeholder:"Add context, decisions, or hypotheses..."}),e.jsx("button",{type:"button",className:"button-outline",onClick:()=>Be(s),disabled:g.length<=1,style:{alignSelf:"flex-start"},children:"Remove"})]},`note-${s}`))}),e.jsx("button",{type:"button",className:"button-outline",onClick:De,style:{marginTop:"12px"},children:"Add another note"})]}),e.jsxs("div",{className:"labs-card",style:{padding:"16px"},children:[e.jsxs("h3",{children:["Uploaded files (",y.length,")"]}),e.jsxs("label",{className:"button-outline",style:{cursor:"pointer",marginBottom:"12px",display:"inline-block"},children:["Upload file",e.jsx("input",{type:"file",hidden:!0,onChange:Ee})]}),e.jsx("ul",{style:{paddingLeft:"20px",margin:0},children:y.map(t=>e.jsxs("li",{style:{marginBottom:"8px"},children:[t.name," ",e.jsx("button",{type:"button",className:"button-inline",onClick:()=>Me(t.id),children:"remove"})]},t.id))})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("span",{children:"Ask the notebook"}),e.jsx("input",{className:"input",value:w,onChange:t=>me(t.target.value),placeholder:"e.g. Summarize the key decisions from these notes."})]}),e.jsx("button",{type:"submit",className:"button-engage",disabled:se,children:se?"Analyzing...":"Run notebook assistant"})]}),ne&&e.jsx("p",{className:"labs-error",style:{marginTop:"12px"},children:ne}),L&&e.jsxs("div",{className:"labs-card",style:{marginTop:"16px"},children:[e.jsx("h3",{children:"Notebook answer"}),e.jsx("p",{style:{whiteSpace:"pre-wrap"},children:L.answer}),e.jsxs("details",{style:{marginTop:"12px"},children:[e.jsx("summary",{children:"Context used"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:L.contextUsed})]})]})]}),e.jsxs("section",{className:"glass-panel",style:{padding:"28px",marginBottom:"28px"},children:[e.jsx("h2",{children:"6. Optional: Speech Preview"}),e.jsx("p",{style:{marginBottom:"12px"},children:"Trigger the placeholder audio endpoint. This does not clone voices; it returns a synthesised tone so you can confirm transport and playback before integrating a production-grade TTS provider."}),e.jsxs("form",{onSubmit:Ie,className:"labs-grid",style:{gap:"16px"},children:[e.jsx("textarea",{className:"textarea",rows:3,value:T,onChange:t=>xe(t.target.value),placeholder:"Text to narrate..."}),e.jsx("button",{type:"submit",className:"button-engage",disabled:le,children:le?"Generating audio...":"Generate preview audio"})]}),ie&&e.jsx("p",{className:"labs-error",style:{marginTop:"12px"},children:ie}),ce&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("audio",{controls:!0,src:ce}),e.jsx("p",{style:{marginTop:"8px",color:"var(--color-grey-600)"},children:"Audio preview generated locally. Swap the backend implementation with production speech synthesis when ready."})]})]})]})}export{qe as default};
