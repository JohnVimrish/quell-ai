import{r,j as e}from"./main-DEHa6zRv.js";const ce=100*1024*1024,Y=["txt","csv","xlsx"];function P(s){if(s.size>ce)return{valid:!1,error:`File size (${(s.size/1048576).toFixed(2)} MB) exceeds the 100 MB limit. Please upload larger files to the designated SharePoint location.`};const d=s.name.split(".").pop()?.toLowerCase();return!d||!Y.includes(d)?{valid:!1,error:`File type not allowed. Supported types: ${Y.join(", ")}`}:{valid:!0}}async function pe(s,d,x,g){const o=P(s);if(!o.valid)return{success:!1,error:o.error};try{const c=new FormData;c.append("file",s),d&&c.append("description",d),x&&c.append("classification",x);const n=new XMLHttpRequest;return g&&n.upload.addEventListener("progress",i=>{i.lengthComputable&&g({loaded:i.loaded,total:i.total,percentage:Math.round(i.loaded/i.total*100)})}),{success:!0,document:await new Promise((i,p)=>{n.addEventListener("load",()=>{if(n.status>=200&&n.status<300){const f=JSON.parse(n.responseText);i(f)}else try{const f=JSON.parse(n.responseText);p(new Error(f.error||"Upload failed"))}catch{p(new Error(`Upload failed with status ${n.status}`))}}),n.addEventListener("error",()=>{p(new Error("Network error during upload"))}),n.addEventListener("abort",()=>{p(new Error("Upload aborted"))}),n.open("POST","/api/documents/upload"),n.withCredentials=!0,n.send(c)})}}catch(c){return{success:!1,error:c instanceof Error?c.message:"Unknown error occurred"}}}async function ue(s,d,x,g){if(!s||!s.trim())return{success:!1,error:"Content cannot be empty"};if(!d||!d.trim())return{success:!1,error:"Name is required"};try{const o=await fetch("/api/documents/text",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:s,name:d,description:x,classification:g})});return o.ok?{success:!0,document:await o.json()}:{success:!1,error:(await o.json()).error||"Submission failed"}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error occurred"}}}function Z(s){return s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(2)} KB`:`${(s/(1024*1024)).toFixed(2)} MB`:"Unknown"}function $(s){switch(s?.toLowerCase()){case"txt":return"Text File";case"csv":return"CSV Data";case"xlsx":return"Excel Spreadsheet";case"text_input":return"Text Input";default:return"Document"}}function he(){const[s,d]=r.useState([]),[x,g]=r.useState(!0),[o,c]=r.useState(null),[n,M]=r.useState("active"),[k,i]=r.useState(null),[p,f]=r.useState(!1),[E,T]=r.useState(null),[_,a]=r.useState(null),[O,h]=r.useState(null),[j,B]=r.useState(""),[b,F]=r.useState(""),[W,R]=r.useState(""),[m,S]=r.useState(null),[V,I]=r.useState(""),[H,U]=r.useState(!1),[D,Q]=r.useState([]),[L,q]=r.useState(!1),[v,N]=r.useState({show:!1,docId:null,docName:""}),[J,A]=r.useState(""),[C,z]=r.useState({show:!1,docId:null,versions:[]}),y=r.useRef(null);r.useEffect(()=>{w()},[]);async function w(){g(!0),c(null);try{const t=await fetch("/api/documents",{credentials:"include"});if(!t.ok)throw new Error(`request failed: ${t.status}`);const l=await t.json();d(l.documents)}catch(t){c(t instanceof Error?t.message:"unknown error")}finally{g(!1)}}function ee(t){const l=t.target.files?.[0];if(l){const u=P(l);if(!u.valid){a(u.error||"Invalid file");return}S(l),a(null)}}function te(t){t.preventDefault(),U(!0)}function se(t){t.preventDefault(),U(!1)}function ne(t){t.preventDefault(),U(!1);const l=t.dataTransfer.files[0];if(l){const u=P(l);if(!u.valid){a(u.error||"Invalid file");return}S(l),a(null)}}async function re(){if(!m)return;f(!0),a(null),h(null),T(null);const t=await pe(m,V,"internal",T);f(!1),t.success?(h(`File "${m.name}" uploaded successfully!`),S(null),I(""),i(null),y.current&&(y.current.value=""),await w(),setTimeout(()=>h(null),5e3)):a(t.error||"Upload failed")}async function le(){if(!j.trim()||!b.trim()){a("Name and content are required");return}f(!0),a(null),h(null);const t=await ue(j,b,W,"internal");f(!1),t.success?(h(`Text "${b}" submitted successfully!`),B(""),F(""),R(""),i(null),await w(),setTimeout(()=>h(null),5e3)):a(t.error||"Submission failed")}function X(){i(null),S(null),I(""),B(""),F(""),R(""),a(null),T(null),y.current&&(y.current.value="")}async function G(){q(!0);try{const t=await fetch("/api/documents/deleted",{credentials:"include"});if(!t.ok)throw new Error(`Failed to load deleted documents: ${t.status}`);const l=await t.json();Q(l.documents||[])}catch(t){console.error("Error loading deleted documents:",t)}finally{q(!1)}}function oe(t,l){N({show:!0,docId:t,docName:l}),A("")}async function ie(){if(v.docId)try{if(!(await fetch(`/api/documents/${v.docId}?reason=${encodeURIComponent(J)}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Delete failed");h(`Document "${v.docName}" deleted successfully`),N({show:!1,docId:null,docName:""}),A(""),await w(),setTimeout(()=>h(null),5e3)}catch(t){a(t instanceof Error?t.message:"Delete failed")}}async function ae(t,l){try{if(!(await fetch(`/api/documents/${t}/restore`,{method:"POST",credentials:"include"})).ok)throw new Error("Restore failed");h(`Document "${l}" restored successfully`),await w(),await G(),setTimeout(()=>h(null),5e3)}catch(u){a(u instanceof Error?u.message:"Restore failed")}}async function de(t){try{const l=await fetch(`/api/documents/${t}/versions`,{credentials:"include"});if(!l.ok)throw new Error("Failed to load versions");const u=await l.json();z({show:!0,docId:t,versions:u.versions||[]})}catch(l){a(l instanceof Error?l.message:"Failed to load version history")}}function K(t){M(t),t==="deleted"&&D.length===0&&G()}return e.jsxs("div",{className:"section-padding",children:[e.jsxs("div",{className:"glass-panel",style:{padding:"48px",marginBottom:"32px"},children:[e.jsx("h1",{className:"page-title",children:"Document Guardrails & Data Feeds"}),e.jsx("p",{className:"page-intro",children:"Upload data feeds for AI processing and control which documents the AI can surface in meetings or chat. All uploads are processed with local OLLama for semantic search."})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"32px",marginBottom:"32px"},children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{className:"panel-title",children:"Upload Data Feed"}),e.jsx("span",{className:"panel-subtitle",children:"Upload text files, CSV, or Excel data for AI semantic processing (max 100MB)"})]}),O&&e.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"#d4edda",color:"#155724",borderRadius:"8px"},children:O}),_&&e.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"#f8d7da",color:"#721c24",borderRadius:"8px"},children:_}),!k&&e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>i("file"),style:{padding:"12px 24px"},children:"📁 Upload File"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>i("text"),style:{padding:"12px 24px"},children:"📝 Enter Text"})]}),k==="file"&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsxs("div",{style:{border:H?"2px dashed #007bff":"2px dashed #ccc",borderRadius:"8px",padding:"32px",textAlign:"center",background:H?"#f0f8ff":"#f9f9f9",cursor:"pointer"},onDragOver:te,onDragLeave:se,onDrop:ne,onClick:()=>y.current?.click(),children:[e.jsx("input",{ref:y,type:"file",accept:".txt,.csv,.xlsx",onChange:ee,style:{display:"none"}}),!m&&e.jsxs(e.Fragment,{children:[e.jsx("p",{style:{fontSize:"18px",marginBottom:"8px"},children:"📤 Drag and drop file here or click to browse"}),e.jsx("p",{style:{fontSize:"14px",color:"#666"},children:"Supported: .txt, .csv, .xlsx (max 100MB)"})]}),m&&e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"8px"},children:["✅ ",m.name]}),e.jsxs("p",{style:{fontSize:"14px",color:"#666"},children:[Z(m.size)," • ",$(m.name.split(".").pop())]})]})]}),m&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Description (optional):"}),e.jsx("textarea",{value:V,onChange:t=>I(t.target.value),placeholder:"Enter a description for this file...",rows:3,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ccc",fontFamily:"inherit"}})]}),E&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsxs("div",{style:{marginBottom:"8px",display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[E.percentage,"%"]})]}),e.jsx("div",{style:{height:"8px",background:"#e0e0e0",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",background:"#007bff",width:`${E.percentage}%`,transition:"width 0.3s"}})})]}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"12px"},children:[e.jsx("button",{className:"btn btn-primary",onClick:re,disabled:!m||p,style:{padding:"10px 24px"},children:p?"Uploading...":"Upload"}),e.jsx("button",{className:"btn btn-secondary",onClick:X,disabled:p,style:{padding:"10px 24px"},children:"Cancel"})]})]}),k==="text"&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Name: *"}),e.jsx("input",{type:"text",value:b,onChange:t=>F(t.target.value),placeholder:"Enter a name for this text input...",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ccc",fontFamily:"inherit"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Content: *"}),e.jsx("textarea",{value:j,onChange:t=>B(t.target.value),placeholder:"Enter or paste your text content here...",rows:10,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ccc",fontFamily:"inherit"}}),e.jsxs("p",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:[j.length," characters"]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Description (optional):"}),e.jsx("textarea",{value:W,onChange:t=>R(t.target.value),placeholder:"Enter a description...",rows:3,style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ccc",fontFamily:"inherit"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{className:"btn btn-primary",onClick:le,disabled:!j.trim()||!b.trim()||p,style:{padding:"10px 24px"},children:p?"Submitting...":"Submit"}),e.jsx("button",{className:"btn btn-secondary",onClick:X,disabled:p,style:{padding:"10px 24px"},children:"Cancel"})]})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"32px",marginBottom:"32px"},children:[e.jsx("h2",{className:"panel-title",children:"Policy snapshot"}),e.jsxs("div",{className:"bullet-columns",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"bullet-heading",children:"Sharing heuristics"}),e.jsxs("ul",{className:"bullet-list",children:[e.jsx("li",{children:"Auto-share only with verified attendees or internal domains."}),e.jsx("li",{children:'Context tags (for example, "budget review") map instructions to files.'}),e.jsx("li",{children:"One-click revoke stops AI usage but keeps audit logs."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"bullet-heading",children:"Audit highlights"}),e.jsxs("ul",{className:"bullet-list",children:[e.jsx("li",{children:"Every share is logged with session metadata for audits."}),e.jsx("li",{children:"Voice disclosure and document policy rely on the same toggle."}),e.jsx("li",{children:"Retention timers clean up sensitive assets automatically."})]})]})]})]}),e.jsxs("div",{className:"glass-panel",style:{padding:"32px"},children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{className:"panel-title",children:"Managed documents"}),e.jsx("span",{className:"panel-subtitle",children:"Define the approved corpus the AI can reference or share."})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",borderBottom:"1px solid #ddd"},children:[e.jsx("button",{onClick:()=>K("active"),style:{padding:"12px 24px",background:"none",border:"none",borderBottom:n==="active"?"2px solid #007bff":"none",color:n==="active"?"#007bff":"#666",cursor:"pointer",fontWeight:n==="active"?"bold":"normal"},children:"Active Documents"}),e.jsx("button",{onClick:()=>K("deleted"),style:{padding:"12px 24px",background:"none",border:"none",borderBottom:n==="deleted"?"2px solid #007bff":"none",color:n==="deleted"?"#007bff":"#666",cursor:"pointer",fontWeight:n==="deleted"?"bold":"normal"},children:"Deleted Documents"})]}),n==="active"&&e.jsxs(e.Fragment,{children:[x&&e.jsx("p",{children:"Loading documents..."}),!x&&o&&e.jsx("p",{role:"alert",children:o}),!x&&!o&&s.length===0&&e.jsx("p",{children:"No documents saved yet. Upload a briefing pack or link a shared drive item to start."}),!x&&!o&&s.length>0&&e.jsxs("div",{className:"table",role:"table",children:[e.jsxs("div",{className:"table-row table-header",role:"row",children:[e.jsx("span",{role:"columnheader",children:"Name"}),e.jsx("span",{role:"columnheader",children:"Type"}),e.jsx("span",{role:"columnheader",children:"Size"}),e.jsx("span",{role:"columnheader",children:"Version"}),e.jsx("span",{role:"columnheader",children:"AI Processed"}),e.jsx("span",{role:"columnheader",children:"Actions"})]}),s.map(t=>e.jsxs("div",{className:"table-row",role:"row",children:[e.jsx("span",{role:"cell",title:t.description||t.name,children:t.name}),e.jsx("span",{role:"cell",children:$(t.file_type)}),e.jsx("span",{role:"cell",children:Z(t.file_size_bytes)}),e.jsxs("span",{role:"cell",children:["v",t.version||1,t.version&&t.version>1&&e.jsx("button",{onClick:()=>de(t.id),style:{marginLeft:"8px",padding:"2px 8px",fontSize:"12px",cursor:"pointer"},children:"History"})]}),e.jsx("span",{role:"cell",children:t.has_embedding?"✅ Yes":"⏳ Pending"}),e.jsx("span",{role:"cell",children:e.jsx("button",{onClick:()=>oe(t.id,t.name),style:{padding:"4px 12px",background:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Delete"})})]},t.id))]})]}),n==="deleted"&&e.jsxs(e.Fragment,{children:[L&&e.jsx("p",{children:"Loading deleted documents..."}),!L&&D.length===0&&e.jsx("p",{children:"No deleted documents."}),!L&&D.length>0&&e.jsxs("div",{className:"table",role:"table",children:[e.jsxs("div",{className:"table-row table-header",role:"row",children:[e.jsx("span",{role:"columnheader",children:"Name"}),e.jsx("span",{role:"columnheader",children:"Type"}),e.jsx("span",{role:"columnheader",children:"Deleted At"}),e.jsx("span",{role:"columnheader",children:"Actions"})]}),D.map(t=>e.jsxs("div",{className:"table-row",role:"row",children:[e.jsx("span",{role:"cell",children:t.name}),e.jsx("span",{role:"cell",children:$(t.file_type)}),e.jsx("span",{role:"cell",children:t.deleted_at?new Date(t.deleted_at).toLocaleDateString():"Unknown"}),e.jsx("span",{role:"cell",children:e.jsx("button",{onClick:()=>ae(t.id,t.name),style:{padding:"4px 12px",background:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Restore"})})]},t.id))]})]})]}),v.show&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>N({show:!1,docId:null,docName:""}),children:e.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"8px",maxWidth:"500px",width:"90%"},onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:"Delete Document"}),e.jsxs("p",{children:['Are you sure you want to delete "',v.docName,'"?']}),e.jsx("p",{style:{fontSize:"14px",color:"#666"},children:"The document will be hidden but data preserved for audit purposes."}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px"},children:"Reason (optional):"}),e.jsx("input",{type:"text",value:J,onChange:t=>A(t.target.value),placeholder:"Enter reason for deletion...",style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>N({show:!1,docId:null,docName:""}),style:{padding:"8px 16px"},children:"Cancel"}),e.jsx("button",{onClick:ie,style:{padding:"8px 16px",background:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Delete"})]})]})}),C.show&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>z({show:!1,docId:null,versions:[]}),children:e.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"8px",maxWidth:"600px",width:"90%",maxHeight:"80vh",overflow:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:"Version History"}),C.versions.length===0&&e.jsx("p",{children:"No version history available."}),C.versions.length>0&&e.jsx("div",{children:C.versions.map(t=>e.jsxs("div",{style:{padding:"12px",marginBottom:"12px",border:"1px solid #ddd",borderRadius:"4px"},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:["Version ",t.version]}),e.jsx("div",{style:{fontSize:"14px",color:"#666"},children:t.created_at?new Date(t.created_at).toLocaleString():"Unknown date"})]},t.version))}),e.jsx("button",{onClick:()=>z({show:!1,docId:null,versions:[]}),style:{padding:"8px 16px",marginTop:"16px"},children:"Close"})]})})]})}export{he as default};
