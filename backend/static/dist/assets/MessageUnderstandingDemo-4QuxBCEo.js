import{r as a,j as e}from"./main-CqeJaehZ.js";const S=[{value:"en",label:"English"},{value:"es",label:"Spanish"},{value:"fr",label:"French"},{value:"de",label:"German"},{value:"zh",label:"Chinese"},{value:"auto",label:"Auto detect"}];function T(){const[o,h]=a.useState(""),[n,r]=a.useState("auto"),[u,C]=a.useState("en"),[i,k]=a.useState(""),[m,I]=a.useState(null),[g,x]=a.useState(!1),[j,f]=a.useState(!1),[t,N]=a.useState(null),[v,w]=a.useState(""),[y,c]=a.useState(""),[p,L]=a.useState(!0),P=a.useMemo(()=>n==="auto"?void 0:n,[n]);a.useEffect(()=>{const s=document.title;return document.title="Message Lab",()=>{document.title=s}},[]),a.useEffect(()=>{c("")},[o,n,u,m,i]);const U=async s=>{if(s.preventDefault(),!o.trim()){c("Please enter a message to process.");return}x(!0),c(""),N(null);try{const l=await fetch("/api/messages/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o,srcLang:P,userLang:u,mediaUrls:i?[i]:void 0})});if(!l.ok){const d=await l.json().catch(()=>({}));throw new Error(d.error||"Failed to process message.")}const b=await l.json();N(b)}catch(l){c(l instanceof Error?l.message:"Unexpected error.")}finally{x(!1)}},D=async()=>{if(!m&&!i){c("Please upload an image or provide an image URL.");return}f(!0),c(""),w("");try{let s={userLang:u};if(i)s.imageUrl=i;else if(m){const d=await E(m);s.imageData=d}const l=await fetch("/api/images/describe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!l.ok){const d=await l.json().catch(()=>({}));throw new Error(d.error||"Failed to describe image.")}const b=await l.json();w(b.caption||"No description generated.")}catch(s){c(s instanceof Error?s.message:"Unexpected error while describing image.")}finally{f(!1)}};return e.jsxs("div",{className:"labs-page section-padding",children:[e.jsxs("header",{className:"labs-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Message Lab"}),e.jsx("p",{children:"Simulate Quell-AI's safer splitting, translation, and summarization workflow."})]}),e.jsx("div",{className:"labs-actions",children:e.jsx("button",{type:"button",className:`button-outline ${p?"labs-toggle-active":""}`,onClick:()=>L(s=>!s),children:p?"Hide Chunk Details":"Show Chunk Details"})})]}),e.jsxs("div",{className:"labs-grid",children:[e.jsx("div",{className:"labs-pane labs-pane-input",children:e.jsxs("form",{className:"labs-form",onSubmit:U,children:[e.jsxs("label",{className:"labs-label",children:["Incoming message",e.jsx("textarea",{className:"labs-textarea",placeholder:"Paste a message, transcript, or voicemail...",value:o,onChange:s=>h(s.target.value),rows:12})]}),e.jsxs("div",{className:"labs-row",children:[e.jsxs("label",{className:"labs-label",children:["Sender language",e.jsx("select",{className:"labs-select",value:n,onChange:s=>r(s.target.value),children:S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("label",{className:"labs-label",children:["Your language",e.jsx("select",{className:"labs-select",value:u,onChange:s=>C(s.target.value),children:S.filter(s=>s.value!=="auto").map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"labs-row labs-row-stack",children:[e.jsxs("label",{className:"labs-label",children:["Image (optional)",e.jsx("input",{type:"file",accept:"image/*",onChange:s=>I(s.target.files?s.target.files[0]:null),className:"labs-file-input"})]}),e.jsxs("label",{className:"labs-label",children:["or Image URL",e.jsx("input",{type:"url",placeholder:"https://example.com/image.jpg",className:"labs-input",value:i,onChange:s=>k(s.target.value)})]})]}),y&&e.jsx("p",{className:"labs-error",children:y}),e.jsxs("div",{className:"labs-button-row",children:[e.jsx("button",{type:"submit",className:"button-engage",disabled:g,children:g?"Processing…":"Send Message"}),e.jsx("button",{type:"button",className:"button-outline",onClick:D,disabled:j,children:j?"Analyzing…":"Describe Image"})]})]})}),e.jsxs("div",{className:"labs-pane labs-pane-output",children:[t?e.jsxs("div",{className:"labs-results",children:[e.jsxs("section",{className:"labs-card",children:[e.jsx("h2",{children:"Final Short Form"}),e.jsx("p",{className:"labs-summary",children:t.finalSummary}),e.jsxs("dl",{className:"labs-steps",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Detected Language"}),e.jsx("dd",{children:t.steps.detectedLanguage})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Translation"}),e.jsx("dd",{children:t.steps.translationApplied?t.steps.translationNote:"Not applied"})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Splitter"}),e.jsxs("dd",{children:[t.steps.splitter," (",t.steps.chunkCount," chunks)"]})]})]})]}),e.jsx("section",{className:"labs-card",children:e.jsxs("details",{className:"labs-accordion",open:!0,children:[e.jsx("summary",{children:"Processing steps"}),e.jsx("ol",{className:"labs-pipeline",children:t.steps.pipeline.map((s,l)=>e.jsxs("li",{children:[e.jsx("span",{className:"labs-step-label",children:s.label}),e.jsx("span",{className:"labs-step-detail",children:s.detail})]},s.label+l))})]})}),p&&e.jsxs("section",{className:"labs-card",children:[e.jsx("h3",{children:"Per-chunk summaries"}),e.jsx("div",{className:"labs-chunk-list",children:t.chunks.map(s=>e.jsxs("article",{className:"labs-chunk",children:[e.jsx("header",{children:e.jsxs("span",{children:["Chunk ",s.order+1]})}),e.jsx("pre",{className:"labs-chunk-summary",children:s.summary}),e.jsxs("details",{children:[e.jsx("summary",{children:"View chunk text"}),e.jsx("p",{children:s.text})]})]},s.order))})]})]}):e.jsxs("div",{className:"labs-empty-state",children:[e.jsx("h2",{children:"Awaiting input"}),e.jsx("p",{children:"Paste a long or multilingual message and Quell-AI will break it down into faithful, safer summaries."})]}),v&&e.jsxs("section",{className:"labs-card labs-image-card",children:[e.jsx("h3",{children:"Image understanding"}),e.jsx("p",{children:v})]})]})]})]})}function E(o){return new Promise((h,n)=>{const r=new FileReader;r.onload=()=>{typeof r.result=="string"?h(r.result):n(new Error("Unable to read file"))},r.onerror=()=>n(new Error("Unable to read file")),r.readAsDataURL(o)})}export{T as default};
